---
layout: "layouts/base.njk"
---

{% set project = null %}
{% for p in globokarProjects %}
  {% if p.id == projectId %}
    {% set project = p %}
  {% endif %}
{% endfor %}

{% if project %}
<div class="phd-project-container">
  <div class="project-header">
    <a href="/phd" class="back-link">← Back to All Projects</a>
    <h1 class="project-title">{{ project.title }}</h1>
  </div>

  {% if project.description %}
  <div class="project-description">
    {{ project.description | replace('\n', '<br>') | safe }}
  </div>
  {% endif %}

  {% if project.carouselItems and project.carouselItems.length > 0 %}
  <div class="project-carousel">
    <div class="carousel-container">
      <div class="carousel-slides">
        {% for item in project.carouselItems %}
          {% if item.src %}
          <div class="carousel-slide">
            {% if item.type == 'image' %}
              <img src="{{ item.src }}" alt="{{ project.name }}" loading="lazy">
            {% elif item.type == 'video' %}
              <video controls>
                <source src="{{ item.src }}" type="video/mp4">
                Your browser does not support the video tag.
              </video>
            {% elif item.type == 'youtube' %}
              <div class="video-embed">
                <iframe
                  src="https://www.youtube.com/embed/{{ item.src }}"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen>
                </iframe>
              </div>
            {% elif item.type == 'audio' %}
              <div class="audio-player">
                <audio controls>
                  <source src="{{ item.src }}" type="audio/mpeg">
                  Your browser does not support the audio element.
                </audio>
              </div>
            {% endif %}
          </div>
          {% endif %}
        {% endfor %}
      </div>

      {% if project.carouselItems.length > 1 %}
      <button class="carousel-prev" aria-label="Previous slide">‹</button>
      <button class="carousel-next" aria-label="Next slide">›</button>
      <div class="carousel-indicators"></div>
      {% endif %}
    </div>
  </div>
  {% endif %}
</div>

<script>
  (function() {
    const container = document.querySelector('.carousel-container');
    if (!container) return;

    const slides = container.querySelectorAll('.carousel-slide');
    const prevBtn = container.querySelector('.carousel-prev');
    const nextBtn = container.querySelector('.carousel-next');
    const indicators = container.querySelector('.carousel-indicators');

    if (slides.length <= 1) return;

    let currentSlide = 0;

    // Create indicators
    slides.forEach((_, index) => {
      const dot = document.createElement('button');
      dot.classList.add('carousel-indicator');
      dot.setAttribute('aria-label', `Go to slide ${index + 1}`);
      if (index === 0) dot.classList.add('active');
      dot.addEventListener('click', () => goToSlide(index));
      indicators.appendChild(dot);
    });

    const dots = indicators.querySelectorAll('.carousel-indicator');

    function updateSlides() {
      slides.forEach((slide, index) => {
        slide.style.display = index === currentSlide ? 'flex' : 'none';
      });
      dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentSlide);
      });
    }

    function goToSlide(index) {
      currentSlide = index;
      updateSlides();
    }

    function nextSlide() {
      currentSlide = (currentSlide + 1) % slides.length;
      updateSlides();
    }

    function prevSlide() {
      currentSlide = (currentSlide - 1 + slides.length) % slides.length;
      updateSlides();
    }

    prevBtn.addEventListener('click', prevSlide);
    nextBtn.addEventListener('click', nextSlide);

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') prevSlide();
      if (e.key === 'ArrowRight') nextSlide();
    });

    updateSlides();
  })();
</script>

<style>
  .phd-project-container {
    max-width: 900px;
    margin: 0 auto;
    padding: var(--size-xl) var(--size-m);
  }

  .project-header {
    margin-bottom: var(--size-xl);
  }

  .back-link {
    display: inline-block;
    color: var(--color-text-light);
    margin-bottom: var(--size-m);
    font-size: 0.9rem;
    transition: color 0.2s;
  }

  .back-link:hover {
    color: var(--color-text);
  }

  .project-title {
    font-size: 2.5rem;
    font-weight: normal;
    line-height: 1.2;
    margin-bottom: var(--size-m);
  }

  .project-description {
    font-size: 1.05rem;
    line-height: 1.8;
    color: var(--color-text);
    margin-bottom: var(--size-xl);
    white-space: pre-wrap;
  }

  .project-carousel {
    margin-top: var(--size-xl);
  }

  .carousel-container {
    position: relative;
    background: #1a1a1a;
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid var(--color-border);
  }

  .carousel-slides {
    position: relative;
    min-height: 400px;
  }

  .carousel-slide {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
  }

  .carousel-slide img,
  .carousel-slide video {
    max-width: 100%;
    max-height: 70vh;
    object-fit: contain;
    display: block;
  }

  .video-embed {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
  }

  .video-embed iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .audio-player {
    width: 100%;
    padding: 2rem;
  }

  .audio-player audio {
    width: 100%;
  }

  .carousel-prev,
  .carousel-next {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border: none;
    font-size: 3rem;
    padding: 1rem 1.5rem;
    cursor: pointer;
    transition: background 0.2s;
    z-index: 10;
  }

  .carousel-prev:hover,
  .carousel-next:hover {
    background: rgba(0, 0, 0, 0.9);
  }

  .carousel-prev {
    left: 0;
  }

  .carousel-next {
    right: 0;
  }

  .carousel-indicators {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    padding: 1rem;
    background: rgba(0, 0, 0, 0.3);
  }

  .carousel-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid var(--color-text);
    background: transparent;
    cursor: pointer;
    transition: background 0.2s;
  }

  .carousel-indicator.active {
    background: var(--color-text);
  }

  @media (max-width: 768px) {
    .project-title {
      font-size: 2rem;
    }

    .project-description {
      font-size: 1rem;
    }

    .carousel-slides {
      min-height: 300px;
    }

    .carousel-slide {
      padding: 1rem;
    }

    .carousel-prev,
    .carousel-next {
      font-size: 2rem;
      padding: 0.5rem 1rem;
    }
  }

  @media (max-width: 480px) {
    .project-title {
      font-size: 1.5rem;
    }

    .carousel-slides {
      min-height: 250px;
    }

    .carousel-prev,
    .carousel-next {
      font-size: 1.5rem;
      padding: 0.5rem 0.75rem;
    }
  }
</style>
{% else %}
<div class="phd-project-container">
  <p>Project not found.</p>
  <a href="/phd">← Back to All Projects</a>
</div>
{% endif %}
